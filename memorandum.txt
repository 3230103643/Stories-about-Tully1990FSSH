知乎上讲Tully这篇文献的好文：
https://zhuanlan.zhihu.com/p/397732783?utm_medium=social&utm_psn=1875130849730633729&utm_source=wechat_session

一些感想：完全复现这篇文献花了我刚好20天时间...在修代码过程中遇到的最关键的几个bug如下
（1）混淆了透热态本征能量（即透热态哈密顿矩阵的对角元）和绝热态本征能量，认为它们是一个东西。解决了这个bug后我成功复现了SAC。
（2）计算非绝热耦合dij的时候左乘的vector矩阵忘记转置了...
（3）被python的内置函数所坑..为了对角化哈密顿矩阵我调用了np.linalg.eigh，但是这个函数在求解本征矢的时候会有正负因子的不确定性（不过它会自动帮你单位化）
具体体现为解着解着本征矢突然来了个正负符号突变...所以DAC迟迟解决不了。
后来我引入了一段代码在循环中手动矫正了这个问题，避免了符号的突变，然后DAC就复现好了。这段代码是位于主函数while循环里面，当然也可以写到对角化哈密顿矩阵
的函数里，不过我没那么做。所以在force库里打出来的DAC的dij图像还是有问题的，体现为有两次正负号的突变，图像在这两处正负翻转，所以出现了4个峰。
（4）当然也有一些别的小bug，比如电子态跃迁后调整核的速度，只考虑了大小，忘记保持原有的速度方向...
上面这么多问题只有（3）是被代码本身坑了，其他都是出于我自己对物理图像的不完全理解，所以编程真的只是工具（不过一定要小心对待调用的函数！），真正重要的是你对
物理图像的理解，所以以后当你发现一堆bug时，主要从物理图像找原因，而不是从代码失误上找原因（否则就会对着电脑浪费时间..）。

一些收获：
（1）就像老王教的，debug的过程中要把所有重要的中间值全部画图打出来，这样你才知道发生了什么。
（2）多试试从一些必要条件找问题，比如如果这个模型是对的，那它必须满足布居和能量的守恒，那你就可以把布居和与能量和全部打出来，事实上，问题（1）（2）就是这么
被发现的。能量守恒真的是一个很关键的线索。
（3）最重要的是物理图像，编程只是工具。
（4）分析你得到这个图像的原因，别光盯着数据看，要想这个数据背后体现的物理过程。

对代码的备注：有四个库force、RK4、hoping、potential_and_der_tempsave_origin，分别解决了计算核受力与非绝热耦合以及解哈密顿矩阵、动力学演化、势能面的跳跃
、根据给定位置计算哈密顿矩阵及其导数。有三个重要的主函数，test2_printall用于调试，打出所有中间值的图；FSSH_main_test5_onlymode3_vary_p用于复现ECR模型；
FSSH_main_test4_model12_vary_p用于复现SAC；FSSH_main_test6_model2only_logeE用于复现DAC。名字取得有点长，不过我懒得改了。
Branching_Ratios是徐来学长帮做的ECR的精确解（选FSSH那个），用于和自己的复现结果对照，噢对了，Tully文献上的ECR画错了，所以你要参考这个精确解。
我的dij画出来可能会跟文献上的差一个负号，这没有任何问题，就像前面说的，我们对角化哈密顿矩阵得到的本征矢有一个正负号的不确定性，你只需要注意在全过程中保持
正负号的一致性（也就是不要让它突变）就行了。

《复现结果合集》这个文献里是四张复现的图，SAC跟DAC的都没问题，《ECR 未加高斯疯狂振荡》正如其名，还原了文献中所说FSSH在ECR模型中引入过多干涉的问题，
剩下那个加了高斯的ECR图是对的。
“加了高斯”是什么意思，就是说在原本给定的初始p0上全部加一个高斯分布，p0为初值，展宽自己设（我是1.5），这样能有效减弱振荡。
还有一个ppt是对所有结果的整合，当然也做了简短的解释。

ends~记录自己第一次类科研的经历
2025/3/6 春 19岁 大二下 求是园